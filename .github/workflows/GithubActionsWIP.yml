name: GithubActionsWIP

on:
  push:
    branches: [ main ]

  pull_request:
    branches: [ main ]


env:
  blazorServerDockerFile: './Website.BlazorServer/Dockerfile'
#  blazorServerAppName: 'website-2203-blazor-server'
  blazorWebAssemblyDockerFile: './Website.BlazorWebAssembly/Server/Dockerfile'
#  blazorWebAssemblyAppName: 'website-2203-blazor-webassembly'
#  registryName: 'dioptraregistry'
#  registryLocation: 'uk south'

jobs:

#############################################################################################################
## These jobs are used to gate actions. By creating these jobs we don't need to proliferate the repo checks
#############################################################################################################
#  is-on-fork:
#    name: Running on a fork?
#    runs-on: ubuntu-latest
#    if: github.repository != 'Dioptra/Website.2203'
#    steps:
#    - name: Nothing to see here
#      run: echo ""

#  is-on-dioptra:
#    name: Running on Dioptra/Website.2203?
#    runs-on: ubuntu-latest
#    if: github.repository == 'Dioptra/Website.2203'
#    steps:
#    - name: Nothing to see here
#      run: echo ""

############################################################################################################
# Store the version information
############################################################################################################
  #version:
  #  name: Set version suffix
  #  runs-on: ubuntu-latest

  #  steps:
  #  - id: get
  #    run: |
  #      echo "::set-output name=suffix::$(date +'%Y-%m-%d--%H-%M-%S')"
  #  - id: show
  #    run: |
  #      echo "${{ steps.get.outputs.suffix }}"
  #  outputs:
  #    suffix: ${{ steps.get.outputs.suffix }}
      
      

############################################################################################################
# Build blazor server container
# This is hard-skipped when we only want to perform a comparison (github.event_name != 'workflow_dispatch')
############################################################################################################
  build-blazor-server:
    name: Build Website.BlazorServer docker container
    needs: [version]
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository under $GITHUB_WORKSPACE so the job can access it 🛎️
      uses: actions/checkout@v2
      with:
        persist-credentials: false

    - name: 'Build docker container'
      run: |
        docker build . --file ${{ env.blazorServerDockerFile }}
      

############################################################################################################
# Build blazor webassembly container
# This is hard-skipped when we only want to perform a comparison (github.event_name != 'workflow_dispatch')
############################################################################################################
  build-blazor-webassembly:
    name: Build Website.BlazorWebAssembly docker container
    needs: [version]
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository under $GITHUB_WORKSPACE so the job can access it 🛎️
      uses: actions/checkout@v2
      with:
        persist-credentials: false

    - name: 'Build docker container'
      run: |
        docker build . --file ${{ env.blazorWebAssemblyDockerFile }}
        